<VirtualHost *:443>
    ServerAdmin webmaster@localhost
    ServerName nas.nintendowifi.net
    
    # Logging
    ErrorLog "logs/nas-ssl-error.log"
    CustomLog "logs/nas-ssl-access.log" combined
    
    # SSL Configuration with SSLv3 support
    SSLEngine on
    SSLCertificateFile /usr/local/apache2/conf/certs/server.crt
    SSLCertificateKeyFile /usr/local/apache2/conf/certs/server.key
    SSLCertificateChainFile /usr/local/apache2/conf/certs/nwc.crt
    
    # CRITICAL: Enable SSLv3 for Nintendo DS/Wii
    SSLProtocol all -SSLv2
    SSLCipherSuite RC4-SHA:3DES-EDE-CBC-SHA:AES128-SHA:!aNULL:!eNULL
    SSLHonorCipherOrder on
    
    # Preserve real client IP
    RemoteIPHeader X-Forwarded-For
    RemoteIPInternalProxy 172.19.0.0/16
    
    # Proxy to NAS Server (Python 3)
    ProxyPreserveHost On

    # DLC/Download requests go to DLS1 server (port 9003)
    ProxyPass /download http://dwc-gamespy:9003/download
    ProxyPassReverse /download http://dwc-gamespy:9003/download

    # Everything else goes to NAS server (port 8080)
    ProxyPass / http://dwc-gamespy:8080/
    ProxyPassReverse / http://dwc-gamespy:8080/
    
    # Forward real client IP and SSL info
    RequestHeader set X-Real-IP "%{REMOTE_ADDR}s"
    RequestHeader set X-Forwarded-For "%{REMOTE_ADDR}s"
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Port "443"
    RequestHeader set X-SSL-Client-Cert "%{SSL_CLIENT_CERT}s"
</VirtualHost>